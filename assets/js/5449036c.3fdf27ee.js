"use strict";(self.webpackChunkfeature_probe_docs=self.webpackChunkfeature_probe_docs||[]).push([[9537],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>m});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var s=r.createContext({}),u=function(e){var t=r.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,s=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(a),m=n,b=d["".concat(s,".").concat(m)]||d[m]||c[m]||o;return a?r.createElement(b,l(l({ref:t},p),{},{components:a})):r.createElement(b,l({ref:t},p))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:n,l[1]=i;for(var u=2;u<o;u++)l[u]=a[u];return r.createElement.apply(null,l)}return r.createElement.apply(null,a)}d.displayName="MDXCreateElement"},8629:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>u});var r=a(7462),n=(a(7294),a(3905));const o={sidebar_position:6},l="Setup database",i={unversionedId:"reference/database-setup",id:"reference/database-setup",title:"Setup database",description:"To run the FeatureProbe API, you need to be running a MySQL database (MySQL 5.7 or newer).",source:"@site/docs/reference/database-setup.md",sourceDirName:"reference",slug:"/reference/database-setup",permalink:"/FeatureProbe/reference/database-setup",draft:!1,editUrl:"https://github.com/FeatureProbe/FeatureProbe/blob/main/docs/docs/reference/database-setup.md",tags:[],version:"current",lastUpdatedAt:1678430777,formattedLastUpdatedAt:"Mar 10, 2023",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"defaultSidebar",previous:{title:"Rule Evaluation",permalink:"/FeatureProbe/reference/evaluation-rules"},next:{title:"Deploy a Cluster",permalink:"/FeatureProbe/reference/deployment-cluster"}},s={},u=[{value:"Create database",id:"create-database",level:2},{value:"Create table and initial data",id:"create-table-and-initial-data",level:2},{value:"<strong>Automatically created based on Flyway</strong>",id:"automatically-created-based-on-flyway",level:3},{value:"<strong> Manually import DML/DDL </strong>",id:"-manually-import-dmlddl-",level:3},{value:"<strong>Steps</strong>",id:"steps",level:4}],p={toc:u};function c(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,r.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"setup-database"},"Setup database"),(0,n.kt)("p",null,"To run the FeatureProbe API, you need to be running a MySQL database (MySQL 5.7 or newer)."),(0,n.kt)("h2",{id:"create-database"},"Create database"),(0,n.kt)("p",null,"After connecting to MySQL Server, execute the following SQL to create the FeatureProbe database:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE DATABASE IF NOT EXISTS `feature_probe` /*!40100 DEFAULT CHARACTER SET utf8 */;\n")),(0,n.kt)("h2",{id:"create-table-and-initial-data"},"Create table and initial data"),(0,n.kt)("p",null,"We provide two ways to create tables and initial data:"),(0,n.kt)("h3",{id:"automatically-created-based-on-flyway"},(0,n.kt)("strong",{parentName:"h3"},"Automatically created based on Flyway")),(0,n.kt)("p",null,"No special configuration is required, the FeatureProbe API natively uses ",(0,n.kt)("a",{parentName:"p",href:"https://flywaydb.org/"},"flyway")," to manage and automatically create the database version, in ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/FeatureProbe/FeatureProbe/tree/main/api/admin/src/main/resources/db/migration"},"gitub")," you can see all the change SQL for the database. Every time you start FeatureProbe API, the program will automatically execute DML/DDL, no need to manually maintain the version of the data table."),(0,n.kt)("p",null,"Also, you can view the data in ",(0,n.kt)("inlineCode",{parentName:"p"},"feature_probe.flyway_schema_history")," for database changes."),(0,n.kt)("h3",{id:"-manually-import-dmlddl-"},(0,n.kt)("strong",{parentName:"h3"}," Manually import DML/DDL ")),(0,n.kt)("p",null,"If you do not want to use flyway to automatically create tables and manage database versions, you can obtain native DML/DDL to implement manual import and creation."),(0,n.kt)("p",null,"Before using this method, you need to disable the use of flyway in the application to avoid conflicts. Add the following parameter to disable flyway execution when ",(0,n.kt)("inlineCode",{parentName:"p"},"api")," starts:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"--spring.flyway.enabled=false\n")),(0,n.kt)("h4",{id:"steps"},(0,n.kt)("strong",{parentName:"h4"},"Steps")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"SETP1"),": Clone ",(0,n.kt)("inlineCode",{parentName:"p"},"api")," code"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone https://github.com/FeatureProbe/FeatureProbe.git\n")),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"SETP2"),": Get SQL"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd api\n$ ls -1 admin/src/main/resources/db/migration/V* \\\n| sort -V | xargs cat >> rollup.sql\n")),(0,n.kt)("p",null,"After the execution is complete, the ",(0,n.kt)("inlineCode",{parentName:"p"},"rollup.sql")," file will be generated, which contains all DML and DDL."),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},"SETP3"),": Import SQL"),(0,n.kt)("p",null,"Import the generated ",(0,n.kt)("inlineCode",{parentName:"p"},"rollup.sql")," into the ",(0,n.kt)("inlineCode",{parentName:"p"},"feature_probe")," library."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"mysql> use feature_probe;\nmysql> source ./rollup.sql;\n")),(0,n.kt)("p",null,"After the import is complete, use ",(0,n.kt)("inlineCode",{parentName:"p"},"show tables")," to see all table structures:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},"mysql> show tables;\n+---------------------------+\n|Tables_in_feature_probe|\n+---------------------------+\n| access_token |\n| approval_record |\n| attribute |\n| dictionary |\n| environment |\n|targeting_segment|\n| webhook_settings |\n...\n")),(0,n.kt)("admonition",{type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"It is recommended to use the flyway to automatically maintain the database. Manually importing DML/DDL will result in the inability to automatically upgrade the table structure in the future, and manual maintenance of the version is required.")))}c.isMDXComponent=!0}}]);