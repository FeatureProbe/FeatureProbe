"use strict";(self.webpackChunkfeature_probe_docs=self.webpackChunkfeature_probe_docs||[]).push([[7637],{3905:(e,t,i)=>{i.d(t,{Zo:()=>u,kt:()=>h});var n=i(7294);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,n,r=function(e,t){if(null==e)return{};var i,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||(r[i]=e[i]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)i=a[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(r[i]=e[i])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},u=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var i=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(i),h=r,g=p["".concat(s,".").concat(h)]||p[h]||d[h]||a;return i?n.createElement(g,o(o({ref:t},u),{},{components:i})):n.createElement(g,o({ref:t},u))}));function h(e,t){var i=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=i.length,o=new Array(a);o[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var c=2;c<a;c++)o[c]=i[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}p.displayName="MDXCreateElement"},971:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var n=i(7462),r=(i(7294),i(3905));const a={sidebar_position:3},o="SDK implementation principle",l={unversionedId:"reference/sdk-specification",id:"reference/sdk-specification",title:"SDK implementation principle",description:"This document mainly introduces the implementation principle of FeatureProbe SDK.",source:"@site/docs/reference/sdk-specification.md",sourceDirName:"reference",slug:"/reference/sdk-specification",permalink:"/FeatureProbe/reference/sdk-specification",draft:!1,editUrl:"https://github.com/FeatureProbe/FeatureProbe/blob/main/docs/docs/reference/sdk-specification.md",tags:[],version:"current",lastUpdatedAt:1673256672,formattedLastUpdatedAt:"Jan 9, 2023",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"defaultSidebar",previous:{title:"SDK Introduction",permalink:"/FeatureProbe/reference/sdk-introduction"},next:{title:"SDK Contribution Guide",permalink:"/FeatureProbe/reference/sdk-contributor"}},s={},c=[{value:"Implementation principle",id:"implementation-principle",level:2},{value:"Server-side SDK",id:"server-side-sdk",level:3},{value:"1. Initialization",id:"1-initialization",level:4},{value:"2. Get the toggle result",id:"2-get-the-toggle-result",level:3},{value:"3. Synchronous toggle rules",id:"3-synchronous-toggle-rules",level:4},{value:"4. Toggle access data reporting",id:"4-toggle-access-data-reporting",level:4},{value:"Client-side SDK",id:"client-side-sdk",level:3},{value:"1. Initialization",id:"1-initialization-1",level:4},{value:"2. Get the toggle result",id:"2-get-the-toggle-result-1",level:4},{value:"3. Synchronous toggle results",id:"3-synchronous-toggle-results",level:4},{value:"4. Toggle access data reporting",id:"4-toggle-access-data-reporting-1",level:4}],u={toc:c};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"sdk-implementation-principle"},"SDK implementation principle"),(0,r.kt)("p",null,"This document mainly introduces the implementation principle of FeatureProbe SDK."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The FeatureProbe SDK is divided into two types: Client-side SDK and Server-side SDK. For related concepts, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/reference/sdk-introduction"},"SDK Basic Concepts")," document.")),(0,r.kt)("h2",{id:"implementation-principle"},"Implementation principle"),(0,r.kt)("h3",{id:"server-side-sdk"},"Server-side SDK"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image-20221028095725775",src:i(6442).Z,width:"1778",height:"556"})),(0,r.kt)("p",null,"As shown in the figure above, the Server-Side SDK is mainly used in the back-end services of the business system, and the core implementation mainly includes the following parts:"),(0,r.kt)("h4",{id:"1-initialization"},"1. Initialization"),(0,r.kt)("p",null,"Initialize a FeatureProbe Client instance. Take the Java code as an example. After the ",(0,r.kt)("inlineCode",{parentName:"p"},"FeatureProbe")," instance is created, it means that the initialization is completed."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"FPConfig config = FPConfig.builder().remoteUri(/* FeatureProbe Server URI */)\n         .build();\n// initialization\nFeatureProbe fpClient = new FeatureProbe(/* FeatureProbe Server SDK Key */, config);\n")),(0,r.kt)("p",null,"The working principle of the initialization is that the SDK pulls all toggles/segments ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/FeatureProbe/server-sdk-specification/blob/065c758e62b057e8f0664f9d2561fa1d35200306/spec/toggle_simple_spec.json"},"Rules")," under the specified ",(0,r.kt)("inlineCode",{parentName:"p"},"serverSdkKey")," from the server (FeatureProbe Server) via HTTP , and stored inside the SDK."),(0,r.kt)("p",null,"For businesses that strongly depend on the toggle results, the SDK needs to ensure that the pull of toggle data from the server is as successful as possible during initialization, so we added a ",(0,r.kt)("inlineCode",{parentName:"p"},"StartWait")," waiting mechanism during initialization. When initialization fails (such as network timeout), initialization will be performed retry until the initialization succeeds or the ",(0,r.kt)("inlineCode",{parentName:"p"},"StartWait")," time elapses. At the same time, the SDK provides the ",(0,r.kt)("inlineCode",{parentName:"p"},"fpClient.initialized()")," function to obtain the initial initialization result."),(0,r.kt)("h3",{id:"2-get-the-toggle-result"},"2. Get the toggle result"),(0,r.kt)("p",null,"The SDK provides corresponding functions for the return value types of different toggles to calculate the toggle results:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'boolean boolValue = fpClient. boolValue("YOUR_TOGGLE_KEY", user, false);\nString stringValue = fpClient. stringValue("YOUR_TOGGLE_KEY", user, false);\n....\n')),(0,r.kt)("p",null,"Since the toggle rules are stored in the SDK during initialization, the calculation of the toggle result rules is only implemented in the SDK without any network interaction. When the business code calls the SDK, the return value will be calculated in real time according to the toggle rules cached in the memory."),(0,r.kt)("h4",{id:"3-synchronous-toggle-rules"},"3. Synchronous toggle rules"),(0,r.kt)("p",null,"When the toggle changes, the SDK needs to obtain the latest toggle rules to ensure the realizability of the calculation results. Therefore, the SDK internally adopts a polling (",(0,r.kt)("strong",{parentName:"p"},"Polling"),") mechanism (once every 3 seconds by default) to asynchronously obtain the latest toggle rules from the FeatureProbe server and update them to the cache, and will calculate and return results based on the latest rules each time the toggle results are obtained. We are currently upgrading the polling mechanism to the WebSocket mechanism."),(0,r.kt)("h4",{id:"4-toggle-access-data-reporting"},"4. Toggle access data reporting"),(0,r.kt)("p",null,"The access data of the SDK can be displayed in real time in the ",(0,r.kt)("a",{parentName:"p",href:"/how-to/platform/metrics"},"Data Metrics")," function module, so the SDK will collect the currently hit group and toggle version information each time the toggle result is obtained, in order to ensure that it does not affect SDK access performance, the access data collection will be recorded in the local memory first, and then aggregated and reported to the FeatureProbe Server at regular intervals (every 3 seconds by default)."),(0,r.kt)("h3",{id:"client-side-sdk"},"Client-side SDK"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"image-20221028095725775",src:i(6361).Z,width:"1739",height:"536"})),(0,r.kt)("p",null,"As shown in the figure above, the Client-Side SDK is mainly aimed at the device environment of users such as mobile apps and browsers. The core implementation mainly includes the following parts:"),(0,r.kt)("h4",{id:"1-initialization-1"},"1. Initialization"),(0,r.kt)("p",null,"Since the Client-side SDK itself does not contain the function of rule calculation, it is necessary to upload various attributes of the represented user to the server during initialization, and the server (FeatureProbe Server) calculates all toggles and returns results for the toggles of the current user, and then return to the Client-side SDK to cache in the App. The following is an example of Android SDK initialization:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'val user = FpUser()\nuser.setAttr("name", "bob") // build user attributes\nval config = FpConfig(/* FeatureProbe Server URI */, /* FeatureProbe Server SDK Key */, 10u, true)\nval fpClient = FeatureProbe(config, user) // Report user attributes to perform initialization\n')),(0,r.kt)("h4",{id:"2-get-the-toggle-result-1"},"2. Get the toggle result"),(0,r.kt)("p",null,"Since all toggle calculation results have been synchronized and cached in the app during initialization, when the business code obtains the corresponding toggle value, it is the memory cache result obtained directly through the FeatureProbe SDK."),(0,r.kt)("h4",{id:"3-synchronous-toggle-results"},"3. Synchronous toggle results"),(0,r.kt)("p",null,"The client-side SDK synchronization method is the same as that of the server-side SDK, both of which use the polling (",(0,r.kt)("strong",{parentName:"p"},"Polling"),") mechanism to asynchronously synchronize data from the FeatureProbe server. The main difference is that what the Client-side SDK synchronizes is the toggle result. We are currently upgrading the polling mechanism to the WebSocket mechanism."),(0,r.kt)("h4",{id:"4-toggle-access-data-reporting-1"},"4. Toggle access data reporting"),(0,r.kt)("p",null,"The implementation mechanism of toggle access data reporting is consistent with that of Server-side SDK."))}d.isMDXComponent=!0},6361:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/client_side_sdk-dfba8a1fa1554dab9c4c2b3cb2e266b4.png"},6442:(e,t,i)=>{i.d(t,{Z:()=>n});const n=i.p+"assets/images/server_side_sdk-ce2af449785d664cffcddbd8ab29edf3.png"}}]);