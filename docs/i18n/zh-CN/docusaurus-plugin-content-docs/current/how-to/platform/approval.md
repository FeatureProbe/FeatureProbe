---
sidebar_position: 6
---

# 开关审批
很多时候研发团队对线上变更管理是很严谨的，审批能减少上线风险。另外，FeatureProbe支持在不同环境中设置不同的审批策略，可以把审批策略配置的更精细来提高审批效率。
## 审批设置
项目下的「环境」可以分别设置审批人、分别开启审批。

![toggle targeting screenshot](/approval_settings.png)

1. 环境：此处展示的是项目下的所有环境。
2. 审批人：支持为每个项目设置相同或不同的审批人。审批人会收到该环境下的所有开关的发布审批。
3. 开启审批：支持只为某些环境开启审批，开启审批后，该环境下的所有的开关的发布，都需要走审批流程（注：若环境中存在审批中的开关，是不允许关闭审批的，需等所有的审批完成后，才能关闭审批）。
4. 点击保存，完成审批的设置，审批将正式开启。

## 触发审批
审批设置完成后，开启审批的环境中，如果进行开关的发布，则会触发审批。

![sdk screenshot](/publish.png)

1. 修改开关配置信息，并点击“发起审批”，会看到此次发布的审批人。
2. 变更说明：此时变更说明为必填，作为审批的标题发送给审批人。
3. 点击“确认”：此时审批正式发起，此次审批已经流转到审批人处。

## 审批中心
发布后，审批人就可以在【审批中心】看到啦~可以点击进入开关内进行审批,申请人也可以在申请列表看到。
![history screenshot](/approval_list.png)
![history screenshot](/application_list.png)
+ 审批状态：（待审批、已通过、已拒绝、已跳过、已撤回）
  - 待审批：发布审批后，是“待审批”状态
  - 已通过：“待审批”的开关，审批人审批【通过】后，是“已通过”状态
  - 已拒绝：“待审批”的开关，审批人【拒绝】审批后，是“已拒绝”状态
  - 已跳过：“待审批”的开关，申请人【跳过审批并发布】后，是“已跳过”状态
  - 已撤回：“待审批”的开关，申请人【撤回】审批后，是“已拒绝”状态


## 开关列表及开关配置
审批通过后，申请人需要点击【发布】，才能完成此次发布。
### 开关列表
![history screenshot](/toggle_approval.png)

### 开关配置页面
【待审批】-【申请人】：
![history screenshot](/pending_review_q.png)
【待审批】-【审批人】：
![history screenshot](/pending_review_p.png)
【待发布】-【申请人】：
![history screenshot](/pending_publish.png)
+ 开关状态：（待审批、待发布、已拒绝、已发布）
  - 待审批：发布审批后，是“待审批”状态
  - 待发布：审批人审批【通过】后，是“待发布”状态。此时申请人可以点击【发布】或【放弃变更】
  - 已拒绝：审批人【拒绝】审批后，是“已拒绝”状态。此时申请人需要点击【继续编辑】或【放弃变更】
  - 已发布：“待发布”的开关，申请人点击【发布】后，是“已发布”状态。“待审批”的开关，申请人点击【跳过审批并发布】后，也是“已发布”状态。
注：一旦开启审批，该开关就等于被锁住了，在这次审批完成前（最终“发布”或者“放弃变更”），其他人是不能编辑开关配置再次点击发布的。

另外：除了审批通过，完成发布这种正常流程外，还有一些为特殊场景设置的异常处理功能，如下：
+ 申请人：
  - 跳过审批并发布：情况紧急，申请人需跳过这次审批，直接发布到线上
  - 撤回审批：发布内容有误，申请人终止这次审批及发布
  - 放弃变更：审批通过后，申请人因特殊原因放弃变更到线上
+ 审批人：
  - 拒绝：发布内容不符合预期，审批不通过

