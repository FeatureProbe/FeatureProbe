---
slug: FeatureProbe feature toggle what why and how
title: 功能开关 What? Why? How？
---

在这个数字化时代，产品的研发效率渐渐地成为企业的核心竞争力，所以越来越多的公司开始使用敏捷开发方法来提高产品研发的效率和质量。在敏捷开发中，技术团队的研发效率可以由以下几个指标来衡量：

- **代码部署频率**: 代码部署到生产环境中的频率，这也是开发速度和效率的体现。  

- **平均修复时间（MTTR)**: 在生产中故障出现到恢复的时间。  

- **变更的前置时间**: 从提出变更请求到部署生产中的时间，变更实施所需的时间。

- **产品发布频率**:团队在一段时间内发布的功能数量和频率。  

- **缺陷率**: 在软件开发过程中，所发现和解决的缺陷数量和严重程度。

以上这些因素可以很好地展示产品研发效率，但在当前这个快速变化的市场中，研发过程中的流程和工具必须要跟得上研发速度，一旦产品的研发速度慢于需求变更的速度，新功能上线就会被延迟，而企业也会在快速发展的市场中失去核心竞争力。  

有很多开发工具可以帮助团队简化开发流程、改善协作和沟通，提高工作效率。但工具的使用应该被慎重考虑，研发团队应该选择最能满足研发需求并支持敏捷开发实践的工具。而功能开关，就是敏捷开发中的常用工具。

# What - 什么是功能开关？

「功能开关」(Feature Flag,又称为“特性开关”) 可以允许开发人员在不影响其他功能的情况部署新功能，并在生产环境中通过控制功能的开关灵活控制功能的可用性和可视性，提高了功能部署效率并且降低了发布风险，让团队能够快速满足应用市场需求的变化。

而功能开关的使用十分简单，功能开关会被包含在一个 if 语句里面，当 if 的状态为 true 时，功能开关会被打开，而新功能就会展示给用户，当 if 状态为 false 时，开关会被关闭，那么新功能会被隐藏不会展示给用户。

````
FPUser user new FPUser();
user.with("ATTRIBUTE_NAME_IN_RULE",VALUE_OF_ATTRIBUTE);
boolean boolValue = fpClient.boolValue("YOUR_TOGGLE_KEY",user.false);
if(boolValue){  
    // the code to run if the toggle is on
  }else{ 
    // the code to run if the toggle is off
  }
````

用户可以由不同的属性（如角色、地理位置 、设备类型等）或者自定义的标识符号（用户ID、会员等级等）构成用户组。例如，新功能仅对付费用户或者特定地区的用户开启，功能开关就可以让新功能在限定的范围内测试新功能或者针对特定用户群体提供个性化的体验。

在产品研发过程中，我想大部分的技术团队和产品团队都会遇到以下问题：

**1. 什么时候发布新功能？发布策略是什么?**

**2. 线上故障最快恢复的解决方案是什么？**

**3. 谁可以看到新功能？全量发布？**

功能开关允许你在应用程序运行时控制功能的发布，也就是说你可以在应用程序运行的同时开启或关闭某个功能，而无需重新构建或重新部署代码。它还可以允许研发团队将代码部署到生产环境中，但不对用户开放这个功能代码，只有该功能已经确认可以发布生产环境，才开放给用户。

功能开关可以先确定目标用户，限定新功能用户范围减少对用户的影响，实现在生产环境中进行功能测试。

![](https://gift-pypu-cdn.didistatic.com/static/featureprobe/do1_9jKFddwQrG4eSN6uj654)

# Why - 为什么说功能开关是必不可少的？

功能开关最大的特点就是可以将部署与发布分开，这是以往的软件部署发布方式不容易做到的。研发同学可以随时将新功能代码部署到生产环境中，通过功能开关控制仅让 QA 团队可见，以便于对新功能进行测试，当测试通过后，再逐步开放给更多用户。

##### 1、快速部署

可以让团队快速、安全地将部分业务代码部署到生产中，不需要像传统开发一样，等待所有功能都开发完成后，再合并部署到生产环境中。

##### 2、提高测试效率

QA 测试最好的方式是在生产环境中测试，由于生产环境中测试存在一定的风险，功能开关可以让 QA 团队在生产环境中在不影响用户体验的情况下去测试功能，可以更早地发现问题。

##### 3、功能发布更加灵活

可以在不改变代码情况下开启和关闭功能，更能满足变化莫测的市场环境。
  
##### 4、提高产品迭代速度

功能开关可以让开发人员更快地实现、测试和部署新功能，从而提高产品迭代速度，缩短新功能的上线时间，更快地将产品推向市场。  

##### 5、加速问题定位和修复

功能开关可以让开发人员更快速地定位和修复问题，从而提高产品的稳定性和可靠性，开发人员可以根据需要去关闭某些功能，在不影响用户体验的情况下快速修复问题。

总的来说，功能开关可以帮助技术团队更有效地工作，同时还可以改善用户体验，降低发布新功能的风险。

# How - 怎么实现功能开关？

****有很多方式可以实现功能开关：************

- **Hardcode方式**


代码中使用简单的 if-else 语句，去判断功能是否被开启或关闭，需要更改代码，可能导致部署和维护成本增加。  
- **配置文件**  


使用配置文件启用或禁用功能，如 XML 或 JSON，这些文件在运行时应用程序去读取。需要重新启动应用程序才能应用新的配置。  

- **数据库**

功能开关可以存储在数据库中，应用程序运行时去读取数据库中的数据。增加了数据库的备份和恢复等维护工作。

- **第三方工具**

有许多第三方工具可以提供功能开关管理，如第三方 SaaS 平台 LaunchDarkly、Optimizely、FlagSmith等，或者使用开源解决方案 FeatureProbe。

企业可以根据业务情况去选择功能开关的解决方案，如有充足的时间和人力也可以选择自己来实现，也可以选择成熟的第三方工具。第三方工具可以提供简洁易上手的用户界面，允许开发人员快速创建和配置开关，并提供一系列的分析和监控工具来了解功能开关的使用情况。可以更快速、轻松去创建和管理功能开关的使用情况，不需要额外的代码编写和维护。

![](https://gift-pypu-cdn.didistatic.com/static/featureprobe/do1_Du7ltsS5P8W5qUWkH6Am)
